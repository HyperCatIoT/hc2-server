/*!
 * topcat
 * @author 1248 Ltd. <info@1248.io>
 * @version 1.0.0
 * Copyright .  licensed.
 */

"use strict";angular.module("hypercat.services",[]),angular.module("hypercat.services").service("CatService",["$http","$q","$rootScope",function($http,$q,$rootScope){var service={};return service.post=function(args){var defer=$q.defer(),dataToSend={};return service.isUrlValid(args.url)?(dataToSend={url:args.url,description:args.description||""},$http({method:"POST",url:"/cat",data:dataToSend}).success(function(){defer.resolve()}).error(function(data,status){400===status?defer.reject(data):defer.reject("An error occurred when sending data to the API")})):defer.reject("Invalid URL"),defer.promise},service.get=function(url){var defer=$q.defer();return url&&null!==url||(url="/cat"),$http({method:"GET",url:url}).success(function(data){defer.resolve(data)}).error(function(data,status){400===status?defer.reject(data):defer.reject("An error occurred when sending data to the API")}),defer.promise},service.execute=function(args){var url=args.url,auth=args.auth||null,method=args.method||"GET",data=args.data||null,defer=$q.defer();return service.notify(!1,{}),auth?$http.defaults.headers.common.Authorization="Basic "+btoa(auth.username+":"+auth.password):$http.defaults.headers.common.Authorization=null,url&&null!==url||(url="/cat"),$http({method:method,url:url,data:data}).success(function(d){service.notify(!1,d),defer.resolve(d)}).error(function(d,status){400===status?(service.notify(!0,d),defer.reject(d)):(service.notify(!0,"An error occurred when sending data to the API"),defer.reject("An error occurred when sending data to the API"))}),defer.promise},service.getSimpleCatalogueItems=function(){var json,metadata,i,j,defer=$q.defer(),items=[],simpleItems=[],simpleItem={};return service.get().then(function(catalogue){for(json=JSON.parse(catalogue),items=json.items,i=0;i<items.length;i+=1){for(simpleItem={href:items[i].href},j=0;j<items[i]["item-metadata"].length;j+=1)metadata=items[i]["item-metadata"][j],"urn:X-hypercat:rels:hasDescription:en"===metadata.rel&&(simpleItem.description=metadata.val);simpleItems.push(simpleItem)}defer.resolve(simpleItems)})["catch"](function(err){defer.reject(err)}),defer.promise},service.notify=function(err,data){var numberOfItems=0;err?$rootScope.$emit("notificationUpdate",{error:!0,message:data}):void 0!==data.items?(numberOfItems=data.items.length,$rootScope.$emit("notificationUpdate",{error:!1,items:numberOfItems})):$rootScope.$emit("notificationUpdate",{error:!1,loading:!0})},service}]),angular.module("hypercat.services").service("QueryBuilderService",["$q","$rootScope",function($q,$rootScope){var service={},baseQuery="http://"+window.location.host+"/cat",useAuth=!1,currentUrl=null,currentAuth={username:null,password:null},currentFilters={type:null,value:null};return service.getFullQuery=function(){var prop,fullQuery=baseQuery,hasFilters=!1,hasUrl=!1;if(null!==currentUrl&&(fullQuery+="?url="+encodeURIComponent(currentUrl),hasUrl=!0),void 0!==currentFilters&&null!==currentFilters.type)for(prop in currentFilters.value)currentFilters.value.hasOwnProperty(prop)&&""!==currentFilters.value[prop]&&(fullQuery+=hasFilters?"&":hasUrl?"&":"?",fullQuery+=encodeURIComponent(prop)+"="+encodeURIComponent(currentFilters.value[prop]),hasFilters=!0);return fullQuery},service.getPostQuery=function(){var postQuery='-H "Content-Type: application/json" -X POST -d \'';return postQuery+=JSON.stringify(currentFilters.value),postQuery+="'"},service.getBasicURL=function(){var url=baseQuery;return null!==currentUrl&&(url+="?url="+encodeURIComponent(currentUrl)),url},service.getCurlQuery=function(){var curlQuery="curl ";return useAuth&&(curlQuery+='-H "Authorization: ',curlQuery+=btoa(currentAuth.username+":"+currentAuth.password),curlQuery+='" '),"multi"===currentFilters.type?(curlQuery+=service.getPostQuery(),curlQuery+=" "+baseQuery,null!==currentUrl&&(curlQuery+="?url="+encodeURIComponent(currentUrl))):curlQuery+=service.getFullQuery(),curlQuery},service.objectToQuery=function(object){var prop,query="";for(prop in object)object.hasOwnProperty(prop)&&(""!==query&&(query+="&"),query+=prop+"="+object[prop]);return"?"+query},service.getAuth=function(){return useAuth?{username:currentAuth.username,password:currentAuth.password}:!1},service.urlUpdate=function(data){"default"===data.type?currentUrl=null:"custom"===data.type&&(currentUrl=data.value||"")},service.authUpdate=function(data){useAuth=data.useAuth,currentAuth.username=data.username,currentAuth.password=data.password},service.queryUpdate=function(data){var prop;if(void 0!==data)if(currentFilters.type=data.type,"multi"!==data.type){currentFilters.value={};for(prop in data.value)data.value.hasOwnProperty(prop)&&(currentFilters.value[prop]=data.value[prop])}else currentFilters.value=data.value},service.getCurrentUrl=function(){return null===currentUrl||""===currentUrl?baseQuery:currentUrl},service.getCurrentValues=function(){return currentFilters.value},service.isMulti=function(){return"multi"===currentFilters.type},$rootScope.$on("urlUpdate",function(event,data){service.urlUpdate(data)}),$rootScope.$on("queryUpdate",function(event,data){service.queryUpdate(data)}),$rootScope.$on("authUpdate",function(event,data){service.authUpdate(data)}),service}]);
//# sourceMappingURL=services.min.js.map